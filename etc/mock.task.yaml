version: "3"

vars:
  BIN: "{{.ROOT_DIR}}/.bin"

tasks:
  base-mock:
    cmds:
      - 'go run github.com/vektra/mockery/v3 --dir {{.SRC_DIR}} --filename "{{.MOCK_STRUCT|default .INTERFACE}}.go" --name "{{.INTERFACE | default "Manager"}}" --structname {{.MOCK_STRUCT|default .INTERFACE}} --output ./internal/mocks --with-expecter'

  "Auth":
    sources:
      - internal/auth/domain.go
      - ./internal/pkg/tools/go.mod
    generates:
      - internal/mocks/AuthRepo.go
      - internal/mocks/AuthService.go
    cmds:
      - task: base-mock
        vars:
          SRC_DIR: ./internal/auth
          INTERFACE: "Repo"
          MOCK_STRUCT: "AuthRepo"
      - task: base-mock
        vars:
          SRC_DIR: ./internal/auth
          MOCK_STRUCT: "AuthService"
          INTERFACE: Service

  "Tag":
    sources:
      - internal/tag/domain.go
      - ./internal/pkg/tools/go.mod
    generates:
      - internal/mocks/TagRepo.go
    cmds:
      - task: base-mock
        vars:
          SRC_DIR: ./internal/tag
          INTERFACE: "Repo"
          MOCK_STRUCT: "TagRepo"

  "CharacterRepo":
    sources:
      - ./internal/character/domain/.go
      - ./internal/pkg/tools/go.mod
    generates:
      - internal/mocks/CharacterRepo.go
    cmds:
      - task: base-mock
        vars:
          SRC_DIR: ./internal/character
          MOCK_STRUCT: "CharacterRepo"
          INTERFACE: Repo

  "IndexRepo":
    sources:
      - internal/index/domain.go
      - ./internal/pkg/tools/go.mod
    generates:
      - internal/mocks/IndexRepo.go
    cmds:
      - task: base-mock
        vars:
          SRC_DIR: ./internal/index
          MOCK_STRUCT: "IndexRepo"
          INTERFACE: Repo

  "RevisionRepo":
    sources:
      - internal/revision/domain.go
      - ./internal/pkg/tools/go.mod
    generates:
      - internal/mocks/RevisionRepo.go
    cmds:
      - task: base-mock
        vars:
          SRC_DIR: ./internal/revision
          MOCK_STRUCT: "RevisionRepo"
          INTERFACE: Repo
